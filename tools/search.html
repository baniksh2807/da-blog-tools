<!DOCTYPE html>
<html lang="en">
  <head>
    <title>FindReplace Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description" content="Bulk find & replace tool with publishing workflow for content teams and authors">
    <link rel="stylesheet" href="/tools/search/search.css">
    <!-- Import DA App SDK -->
    <script src="https://da.live/nx/utils/sdk.js" type="module"></script>
    <!-- Project App Logic -->
    <script src="/tools/search/search.js" type="module"></script>
  </head>
  <body>
    <div class="app-container">
      <header class="app-header">
        <div class="header-content">
          <div class="header-main">
            <div class="app-icon">
              <img src="./search/icons/search.svg" alt="Search" class="icon">
            </div>
            <div class="header-text">
              <h1>Bulk Updates</h1>
              <p class="subtitle">Bulk Document Authoring Update</p>
            </div>
          </div>
          <div class="header-actions">
            <button class="help-btn" type="button" aria-label="Help & Documentation">
              <img src="./search/icons/help.svg" alt="Help" class="icon">
            </button>
          </div>
        </div>
      </header>

      <main class="app-main">
        <!-- Configuration Accordion -->
        <div class="config-accordion accordion-card expanded" id="config-accordion">
          <div class="config-accordion-header accordion-header" data-accordion-target="config-content">
            <div class="accordion-header-content">
              <div class="card-icon">
                <img src="./search/icons/replace.svg" alt="Config" class="icon">
              </div>
              <h2>Search Criteria</h2>
            </div>
            <div class="accordion-toggle">
              <img src="./search/icons/chevron-down.svg" alt="Toggle" class="icon accordion-icon">
            </div>
          </div>
          
          <div class="accordion-content" id="config-content">
            <div class="config-container">
          <!-- Main Configuration -->
          <div class="main-config-section">
          <!-- Search Configuration Card -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">
                <img src="./search/icons/search.svg" alt="Search Criteria" class="icon">
              </div>
              <h2>Search Criteria</h2>
            </div>
            
            <div class="card-content">
              
              <!-- Search Paths -->
              <div class="input-group">
                <label for="search-path-input" class="input-label">
                  <span class="label-text">Search Paths</span>
                </label>
                <div class="multi-path-container">
                  <input type="text" id="search-path-input" class="input-field path-input" placeholder="Type to search folders (e.g., /drafts, /fragments)">
                  <div id="search-paths-loader" class="search-paths-loader" style="display: none;">
                    <div class="loader-content">
                      <img src="./search/icons/loading.svg" alt="Loading" class="icon icon-sm loader-icon">
                      <span class="loader-text">Loading folder structure...</span>
                    </div>
                  </div>
                  <div id="search-paths-message" class="search-paths-message" style="display: none;">
                    <span class="message-text">Enter org and site first to browse folders</span>
                  </div>
                  <div class="path-tags" id="path-tags">
                    <!-- Path tags will be added here -->
                  </div>
                </div>
                <div class="checkbox-option">
                  <label class="checkbox-item">
                    <input type="checkbox" id="include-subfolders">
                    <span class="checkbox-label">Include Subfolders</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          </div>

          <!-- Sidebar -->
          <div class="filters-sidebar">
          
          <!-- Configuration Card -->
          <div class="config-card">
            <div class="card-header">
              <div class="card-icon">
                <img src="./search/icons/settings.svg" alt="Configuration" class="icon">
              </div>
              <h2>Configuration</h2>
            </div>
            
            <div class="card-content">
              <div class="input-group">
                <label for="org-site-path" class="input-label">
                  <span class="label-text">Organization/Site</span>
                </label>
                <input type="text" id="org-site-path" class="input-field" placeholder="/org/mysite" value="">
              </div>
            </div>
          </div>
          </div>
            </div>
          </div>
        </div>

        <!-- HTML Operations Accordion -->
        <div class="accordion-card" id="html-operations-accordion">
          <div class="accordion-header" data-accordion-target="html-operations">
            <div class="accordion-header-content">
              <div class="card-icon">
                <img src="./search/icons/code.svg" alt="HTML Operations" class="icon">
              </div>
              <h2>HTML Operations</h2>
            </div>
            <div class="accordion-toggle">
              <img src="./search/icons/chevron-down.svg" alt="Toggle" class="icon accordion-icon">
            </div>
          </div>
          
          <div id="html-operations" class="accordion-content">
            <div class="config-container">
              <div class="main-config-section">
                
                <!-- HTML Operations Configuration Card -->
                <div class="config-card">
                  <div class="card-header">
                    <div class="card-icon">
                      <img src="./search/icons/settings.svg" alt="Configuration" class="icon">
                    </div>
                    <h2>HTML Operations Configuration</h2>
                  </div>
                  
                  <div class="card-content">
                    <!-- Organization/Site -->
                    <div class="input-group">
                      <label for="html-ops-org-site" class="input-label">
                        <span class="label-text">Organization/Site</span>
                      </label>
                      <input type="text" id="html-ops-org-site" class="input-field" placeholder="/org/mysite">
                    </div>

                    <!-- Search Paths -->
                    <div class="input-group">
                      <label for="html-ops-search-path-input" class="input-label">
                        <span class="label-text">Search Paths (Optional)</span>
                      </label>
                      <div class="multi-path-container">
                        <input type="text" id="html-ops-search-path-input" class="input-field path-input" placeholder="Press Enter to add path (e.g., /blog, /articles)">
                        <div class="path-tags" id="html-ops-path-tags">
                          <!-- Path tags will be added here -->
                        </div>
                      </div>
                      <small class="help-text">Leave empty to search entire site. Add specific paths to limit scope.</small>
                    </div>

                    <!-- Include Subfolders -->
                    <div class="checkbox-option">
                      <label class="checkbox-item">
                        <input type="checkbox" id="html-ops-include-subfolders">
                        <span class="checkbox-label">Include Subfolders</span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Scan for Elements Section -->
                <div class="config-card">
                  <div class="card-header">
                    <div class="card-icon">
                      <img src="./search/icons/search.svg" alt="Scan" class="icon">
                    </div>
                    <h2>Scan for Elements</h2>
                  </div>
                  
                  <div class="card-content">
                    <p class="help-text">Find all pages containing elements matching a CSS selector</p>
                    
                    <div class="input-group">
                      <label for="scan-selector" class="input-label">
                        <span class="label-text">CSS Selector to Find</span>
                      </label>
                      <input 
                        type="text" 
                        id="scan-selector" 
                        class="input-field"
                        placeholder="Enter CSS selector (e.g., .header-article-pro)"
                      >
                      <small class="help-text">Scan will show all pages containing these elements</small>
                    </div>

                    <button id="scan-elements-btn" class="btn btn-primary">
                      <img src="./search/icons/search.svg" alt="Scan" class="icon">
                      <span>Scan for Elements</span>
                    </button>
                  </div>
                </div>
                
                <!-- Add HTML Node Section -->
                <div class="config-card">
                  <div class="card-header">
                    <div class="card-icon">
                      <img src="./search/icons/plus.svg" alt="Add" class="icon">
                    </div>
                    <h2>Add HTML Node</h2>
                  </div>
                  
                  <div class="card-content">
                    <p class="help-text">Add HTML content to pages at a specified location</p>
                    
                    <div class="input-group">
                      <label for="html-content" class="input-label">
                        <span class="label-text">HTML Content to Add</span>
                      </label>
                      <textarea 
                        id="html-content" 
                        rows="8"
                        class="input-field"
                        placeholder="Enter HTML to add (e.g., <div class='header-article-pro'>...</div>)"
                      ></textarea>
                    </div>

                    <div class="input-group">
                      <label for="insert-position" class="input-label">
                        <span class="label-text">Insert Position</span>
                      </label>
                      <select id="insert-position" class="input-field">
                        <option value="append">Append (at end of target)</option>
                        <option value="prepend">Prepend (at beginning of target)</option>
                        <option value="before">Before (before target element)</option>
                        <option value="after">After (after target element)</option>
                      </select>
                    </div>

                    <div class="input-group">
                      <label for="target-selector" class="input-label">
                        <span class="label-text">Target Selector (optional)</span>
                      </label>
                      <input 
                        type="text" 
                        id="target-selector"
                        class="input-field"
                        placeholder="CSS selector (e.g., main, .content) - leave empty for main/body"
                      >
                      <small class="help-text">Leave empty to target main content area</small>
                    </div>

                    <button id="add-html-btn" class="btn btn-primary" disabled>
                      <img src="./search/icons/plus.svg" alt="Add" class="icon">
                      <span>Add HTML to Selected Files</span>
                    </button>
                  </div>
                </div>

                <!-- Delete HTML Node Section -->
                <div class="config-card">
                  <div class="card-header">
                    <div class="card-icon">
                      <img src="./search/icons/trash.svg" alt="Delete" class="icon">
                    </div>
                    <h2>Delete HTML Node</h2>
                  </div>
                  
                  <div class="card-content">
                    <p class="help-text">Remove HTML elements matching a CSS selector</p>
                    
                    <div class="input-group">
                      <label for="delete-selector" class="input-label">
                        <span class="label-text">CSS Selector to Delete</span>
                      </label>
                      <input 
                        type="text" 
                        id="delete-selector"
                        class="input-field"
                        placeholder="Enter CSS selector (e.g., .header-article-pro, #hero)"
                      >
                      <small class="help-text">All matching elements will be removed from selected files</small>
                    </div>

                    <button id="delete-html-btn" class="btn btn-danger" disabled>
                      <img src="./search/icons/trash.svg" alt="Delete" class="icon">
                      <span>Delete Elements from Selected Files</span>
                    </button>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
          <div class="primary-actions">
            <button id="scan-btn" class="btn btn-primary">
              <img src="./search/icons/search.svg" alt="Scan" class="icon">
              <span>Scan & Preview</span>
            </button>
          </div>
          
          <div class="secondary-actions">
            <button id="execute-btn" class="btn btn-secondary" disabled>
              <img src="./search/icons/replace.svg" alt="Execute" class="icon">
              <span>Execute Replace</span>
            </button>
            
            <button id="export-btn" class="btn btn-outline" disabled>
              <img src="./search/icons/download.svg" alt="Export" class="icon">
              <span id="export-btn-text">Export Files</span>
            </button>
            
            <button id="revert-btn" class="btn btn-warning" disabled>
              <img src="./search/icons/revert.svg" alt="Revert" class="icon">
              <span id="revert-btn-text">Revert Selected</span>
            </button>
            
            <div class="bulk-operations">
              <select id="bulk-operation-type" class="operation-select">
                <option value="copy-urls">Copy URLs</option>
                <option value="preview">Preview</option>
                <option value="publish">Publish</option>
                <option value="unpublish">Unpublish</option>
              </select>
              <button id="bulk-publish-btn" class="btn btn-success" disabled>
                <img src="./search/icons/preview.svg" alt="Bulk Operation" class="icon">
                <span id="bulk-btn-text">Preview Selected</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-container" style="display: none;">
          <div class="progress-card">
            <div class="progress-content">
              <div class="progress-icon">
                <img src="./search/icons/loading.svg" alt="Progress" class="icon">
              </div>
              <div class="progress-info">
                <div class="progress-text">Scanning files...</div>
                <div class="progress-bar">
                  <div class="progress-fill"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Results Section -->
        <div class="results-container accordion-card" style="display: none;">
          <div class="card-header accordion-header" data-accordion-target="search-results">
            <div class="card-icon">
              <img src="./search/icons/check.svg" alt="Search Results" class="icon">
            </div>
            <div class="header-text">
              <h2>Search Results</h2>
              <div class="results-summary">
                <div class="summary-item">
                  <span class="summary-number" id="files-scanned">0</span>
                  <span class="summary-label">Files Scanned</span>
                </div>
                <div class="summary-item">
                  <span class="summary-number" id="matches-found">0</span>
                  <span class="summary-label">Matches Found</span>
                </div>
                <div class="summary-item">
                  <span class="summary-number" id="files-affected">0</span>
                  <span class="summary-label">Files Affected</span>
                </div>
              </div>
            </div>
            <div class="accordion-toggle">
              <img src="./search/icons/chevron-down.svg" alt="Toggle Results" class="icon accordion-icon">
            </div>
          </div>
          
          <div class="card-content accordion-content" id="search-results" style="display: none;">
            <div class="results-controls">
              <div class="selection-controls">
                <button id="toggle-all" class="btn btn-sm btn-outline">Select All</button>
                <button id="clear-selection" class="btn btn-sm btn-outline">Clear Selection</button>
                <button id="expand-all" class="btn btn-sm btn-outline">Expand All</button>
                <button id="collapse-all" class="btn btn-sm btn-outline">Collapse All</button>
              </div>
              <div class="filter-controls">
                <div class="search-input">
                  <img src="./search/icons/search.svg" alt="Search" class="icon search-icon">
                  <input type="text" id="filter-results" placeholder="Filter by file path or content..." class="filter-input">
                </div>
              </div>
            </div>
            
            <div class="results-content">
              <div class="results-list" id="results-list">
                <!-- Results will be populated here -->
              </div>
              
              <!-- Pagination Controls -->
              <div class="pagination-container" id="pagination-container" style="display: none;">
                <div class="pagination-info">
                  <span id="pagination-info-text">Showing 1-10 of 25 results</span>
                </div>
                <div class="pagination-controls">
                  <button id="prev-page" class="pagination-btn" disabled>
                    <img src="./search/icons/chevron-left.svg" alt="Previous" class="icon icon-sm">
                    Previous
                  </button>
                  
                  <div class="page-numbers" id="page-numbers">
                    <!-- Page numbers will be populated here -->
                  </div>
                  
                  <button id="next-page" class="pagination-btn">
                    Next
                    <img src="./search/icons/chevron-right.svg" alt="Next" class="icon icon-sm">
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Help Modal -->
        <div id="help-modal" class="modal-overlay hidden">
          <div class="modal-content">
            <div class="modal-header">
              <h2>FindReplace Pro Help</h2>
              <button class="modal-close" aria-label="Close help">
                <img src="./search/icons/close.svg" alt="Close" class="icon">
              </button>
            </div>
            
            <div class="modal-body">
              <div class="help-section">
                <h3>What is FindReplace Pro?</h3>
                <p>Bulk find & replace tool with publishing workflow. Search your site content and publish changes.</p>
              </div>

              <div class="help-section">
                <h3>Key Features</h3>
                <ul class="help-list">
                  <li><strong>Advanced Search</strong> - Text, regex, and HTML mode with case sensitivity</li>
                  <li><strong>Multi-Path Support</strong> - Tag-based directory selection with autocomplete</li>
                  <li><strong>Element Discovery</strong> - Find pages containing specific CSS selectors</li>
                  <li><strong>Granular Selection</strong> - Select individual matches within files</li>
                  <li><strong>HTML Mode</strong> - Search and replace entire HTML blocks</li>
                  <li><strong>Automatic Versioning</strong> - Creates backup versions before any content changes</li>
                  <li><strong>Version Revert</strong> - Restore files to their most recent saved versions</li>
                  <li><strong>Bulk Operations</strong> - Replace content and publish with progress tracking</li>
                  <li><strong>Smart Filtering</strong> - Filter results by path, exclude URLs and paths</li>
                  <li><strong>Export & Publishing</strong> - Download files or preview/publish/unpublish</li>
                </ul>
              </div>

              <div class="help-section">
                <h3>How to Use</h3>
                <div class="help-steps">
                  <div class="help-step">
                    <span class="step-number">1</span>
                    <div class="step-content">
                      <strong>Configure</strong>
                      <p>Set org/site, select search paths, and configure advanced filters as needed.</p>
                    </div>
                  </div>
                  <div class="help-step">
                    <span class="step-number">2</span>
                    <div class="step-content">
                      <strong>Search</strong>
                      <p>Enter search term, choose search type (text/regex/HTML mode), and click "Scan & Preview" to find matches.</p>
                    </div>
                  </div>
                  <div class="help-step">
                    <span class="step-number">3</span>
                    <div class="step-content">
                      <strong>Select & Execute</strong>
                      <p>Select files/matches, enter replacement text, and use "Execute Replace", publishing operations, or "Revert Selected" to restore files. Backup versions are automatically created before any changes.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Toast Messages -->
        <div class="toast-container">
          <div class="toast hidden" id="toast">
            <div class="toast-content">
              <div class="toast-icon">
                <img src="./search/icons/check.svg" alt="Success" class="icon">
              </div>
              <div class="toast-message"></div>
              <button class="toast-close" aria-label="Close notification">
                <img src="./search/icons/close.svg" alt="Close" class="icon icon-sm">
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>